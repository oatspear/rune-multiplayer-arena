<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Secular+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="components/battle.js"></script>
  </head>
  <body>
    <main id="app">
      <battle-header :current-turn="currentTurn" :num-players="players.length"></battle-header>

      <battle-board
        :tiles="tiles"
        :players="players"
        :selected-enemy="ui.selectedEnemy"
        :selected-player="ui.selectedPlayer"
        @selected-enemy="onEnemySelected"
        @selected-player="onPlayerSelected"
      >
      </battle-board>

      <battle-footer
        v-bind="ui.footer"
        @use-ability="onUseAbility"
      >
      </battle-footer>
    </main>

    <template id="vue-battle-header">
      <header>
        <div class="turn">
          <div class="slot">
            <span v-if="currentTurn == 0">▼</span>
          </div>
          <div class="slot" v-if="numPlayers > 1">
            <span v-if="currentTurn == 1">▼</span>
          </div>
          <div class="slot" v-if="numPlayers > 2">
            <span v-if="currentTurn == 2">▼</span>
          </div>
          <div class="slot" v-if="numPlayers > 3">
            <span v-if="currentTurn == 3">▼</span>
          </div>
        </div>
      </header>
    </template>

    <template id="vue-battle-board">
      <div id="board">
          <div class="slides-container" id="slides-container">
            <battle-scene
              :scene-index="0"
              :tiles="tiles[0]"
              :players="players"
              :player-index="0"
              :selected-enemy="selectedEnemy"
              :selected-player="selectedPlayer"
              @selected-enemy="onEnemySelected"
              @selected-player="onPlayerSelected"
            >
            </battle-scene>
          </div>
      </div>
    </template>

    <template id="vue-battle-scene">
      <div :id="`battle-scene-${sceneIndex}`" class="slide">
        <div class="row">
          <battle-tile
            v-for="n in tiles.length"
            :tile-index="(n-1)"
            :tile-data="tiles[n-1]"
            :is-active="selectedEnemy == (n-1)"
            @selected="onEnemySelected"
          >
          </battle-tile>
        </div>
        <div class="row">
          <battle-tile
            v-for="n in players.length"
            :tile-index="(n-1)"
            :tile-data="players[n-1]"
            :is-active="selectedPlayer == (n-1)"
            :is-owned="playerIndex == (n-1)"
            @selected="onPlayerSelected"
          >
          </battle-tile>
        </div>
      </div>
    </template>

    <template id="vue-battle-tile">
      <div class="tile-container">
        <div
          class="tile"
          :class="{active: isActive, boss: isBoss, owned: isOwned}"
          @click="onTileClick"
        >
          <span class="class" :class="tileData.characterClass.id">{{ tileData.characterClass.name }}</span>
          <div class="icon">
            <img :src="`assets/${tileData.characterClass.id}.png`" alt="?">
          </div>
          <div class="effect-anchor"></div>
          <div class="stats">
            <div class="power">
              <span>{{ tileData.power }}</span>
            </div>
            /
            <div class="health">
              <span>{{ tileData.currentHealth }}</span>
            </div>
          </div>
        </div>
      </div>
    </template>

    <template id="vue-battle-footer">
      <footer>
        <battle-player-info
          :display-name="characterData.name"
          :class-id="characterData.characterClass.id"
          :class-name="characterData.characterClass.name"
          :power-value="characterData.power"
          :health-value="characterData.health"
        ></battle-player-info>
        <battle-action-bar :abilities="characterData.abilities" @use-ability="onUseAbility"></battle-action-bar>
        <!-- <button class="slide-arrow" id="slide-arrow-prev" @click.prevent="showPreviousPlayer">
          &#8249;
        </button>
        <button class="slide-arrow" id="slide-arrow-next" @click.prevent="showNextPlayer">
        &#8250;
        </button> -->
        <p class="description">
          <span class="name">{{ itemName }}</span>
          {{ itemDescription }}
        </p>
      </footer>
    </template>

    <template id="vue-battle-player-info">
      <div class="player-info">
        <h2 class="nameplate">
          <span class="class" :class="classId">{{ className }}</span>
          <span class="name">{{ displayName || "&nbsp;" }}</span>
        </h2>
        <div class="stats">
          <battle-icon-label name="power" :value="powerValue" :size="16" v-if="powerValue > 0"></battle-icon-label>
          <battle-icon-label name="shield" :value="healthValue" :size="16" v-if="healthValue > 0"></battle-icon-label>
        </div>
      </div>
    </template>

    <template id="vue-battle-action-bar">
      <div class="action-bar">
        <div class="center-container">
          <button class="action-button" @click.prevent.stop="useAbility(0)">
            <img :src="`assets/${abilities[0].data.icon}.png`" alt="Skill" width="32" height="32">
          </button>
        </div>
        <div class="center-container">
          <button class="action-button" @click.prevent.stop="useAbility(1)" disabled>
            <img :src="`assets/${abilities[1].data.icon}.png`" alt="Skill" width="32" height="32">
          </button>
        </div>
        <div class="center-container">
          <button class="action-button" @click.prevent.stop="useAbility(2)">
            <img :src="`assets/${abilities[2].data.icon}.png`" alt="Skill" width="32" height="32">
          </button>
        </div>
        <div class="center-container">
          <button class="action-button" @click.prevent.stop="useAbility(3)">
            <img :src="`assets/${abilities[3].data.icon}.png`" alt="Skill" width="32" height="32">
          </button>
        </div>
      </div>
    </template>

    <template id="vue-battle-icon-label">
      <div class="icon-label" :class="name">
        <img :src="`assets/${name}.png`" alt="Icon" :width="size" :height="size">
        <span class="label">{{ value }}</span>
      </div>
    </template>

    <!--<script src="https://cdn.jsdelivr.net/npm/rune-games-sdk@3/multiplayer.js"></script>-->
    <script src="logic.js"></script>
    <script src="client.js"></script>

    <!--
    <div>Icons made by <a href="https://www.flaticon.com/authors/juicy-fish" title="juicy_fish">juicy_fish</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
    <a href="https://www.flaticon.com/free-icons/punch" title="punch icons">Punch icons created by Freepik - Flaticon</a>
    -->
  </body>
</html>
